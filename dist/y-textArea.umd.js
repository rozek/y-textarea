(function(C,j){typeof exports=="object"&&typeof module!="undefined"?j(exports,require("yjs")):typeof define=="function"&&define.amd?define(["exports","yjs"],j):(C=typeof globalThis!="undefined"?globalThis:C||self,j(C["y-textArea"]={},C.Y))})(this,function(C,j){"use strict";function U(t){if(t&&t.__esModule)return t;var r={__proto__:null,[Symbol.toStringTag]:"Module"};return t&&Object.keys(t).forEach(function(e){if(e!=="default"){var i=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(r,e,i.get?i:{enumerable:!0,get:function(){return t[e]}})}}),r.default=t,Object.freeze(r)}var R=U(j),$={exports:{}};(function(t){(function(){var r=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],e=typeof window!="undefined",i=e&&window.mozInnerScreenX!=null;function s(n,o,a){if(!e)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var l=a&&a.debug||!1;if(l){var h=document.querySelector("#input-textarea-caret-position-mirror-div");h&&h.parentNode.removeChild(h)}var u=document.createElement("div");u.id="input-textarea-caret-position-mirror-div",document.body.appendChild(u);var c=u.style,v=window.getComputedStyle?window.getComputedStyle(n):n.currentStyle,b=n.nodeName==="INPUT";c.whiteSpace="pre-wrap",b||(c.wordWrap="break-word"),c.position="absolute",l||(c.visibility="hidden"),r.forEach(function(p){b&&p==="lineHeight"?c.lineHeight=v.height:c[p]=v[p]}),i?n.scrollHeight>parseInt(v.height)&&(c.overflowY="scroll"):c.overflow="hidden",u.textContent=n.value.substring(0,o),b&&(u.textContent=u.textContent.replace(/\s/g,"\xA0"));var d=document.createElement("span");d.textContent=n.value.substring(o)||".",u.appendChild(d);var m={top:d.offsetTop+parseInt(v.borderTopWidth),left:d.offsetLeft+parseInt(v.borderLeftWidth),height:parseInt(v.lineHeight)};return l?d.style.backgroundColor="#aaa":document.body.removeChild(u),m}t.exports=s})()})($);var W=$.exports;function X(t,r){const e=Math.max(t.x,r.x),i=Math.min(t.x+t.width,r.x+r.width);if(i<e)return null;const s=Math.max(t.y,r.y),n=Math.min(t.y+t.height,r.y+r.height);return n<s?null:new Q(e,s,i-e,n-s)}class Q{constructor(r,e,i,s){this.x=r,this.y=e,this.width=i,this.height=s}get area(){return this.width*this.height}}var V=X;const G=["keyup","mouseup","touchstart","paste","cut","selectend"];class K{constructor(r,e,i,s){Object.defineProperty(this,"_div",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_nameDiv",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_color",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_fontSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_selectedIndex",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_parent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._selectedIndex={start:-1,end:-1},this._fontSize=r,this._parent=i.offsetParent||document.body,this._div=document.createElement("div"),this._div.style.position="absolute",this._div.style.height=r,this._div.style.width="1px",this._div.style.display="none",this._div.classList.add("selectedText"),this._parent.appendChild(this._div),s!==void 0&&this.updateCursor(s,e)}show(){this._div.style.display="block",this._nameDiv&&(this._nameDiv.style.display="block")}hide(){this._div.style.display="none",this._nameDiv&&(this._nameDiv.style.display="none")}updateCursor(r,e){this._name===r&&this._color.r===e.r&&this._color.g===e.g&&this._color.b===e.b||(this._color=e,this._name=r,this._nameDiv||(this._nameDiv=document.createElement("div"),this._nameDiv.style.position="absolute",this._nameDiv.style.display="none",this._nameDiv.classList.add("nameTag"),this._parent.appendChild(this._nameDiv)),this._nameDiv.innerHTML=r,this._nameDiv.style.backgroundColor=`rgba(${this._color.r}, ${this._color.g}, ${this._color.b}, 1.0)`,this._div.style.backgroundColor=`rgba(${this._color.r}, ${this._color.g}, ${this._color.b}, 0.4)`)}setPosition(r,e){this._selectedIndex={start:r,end:e}}setWidth(r){this._div.style.width=r+"px",r===1?this._div.style.backgroundColor=`rgba(${this._color.r}, ${this._color.g}, ${this._color.b}, 1.0)`:this._div.style.backgroundColor=`rgba(${this._color.r}, ${this._color.g}, ${this._color.b}, 0.4)`}rePosition(r){if(this._selectedIndex.start===-1||this._selectedIndex.end===-1)return;const e=W(r,this._selectedIndex.start),i=r.offsetTop-r.scrollTop+e.top,s=r.offsetLeft-r.scrollLeft+e.left;let n=1,o=0;if(this._selectedIndex.start!==this._selectedIndex.end){let u=W(r,this._selectedIndex.end);n=u.left-e.left,o=u.top-e.top,o!==0&&(n=1)}const a={x:r.offsetLeft,y:r.offsetTop,width:r.clientWidth,height:r.clientHeight},l={x:s,y:i,width:n,height:parseInt(this._fontSize)},h=V(a,l);if(!h){this.hide();return}this._div.style.top=h.y+"px",this._div.style.left=h.x+"px",this.setWidth(h.width),this.show(),this._nameDiv&&(this._nameDiv.style.top=h.y+parseInt(this._fontSize)+"px",this._nameDiv.style.left=h.x+"px")}destroy(){this._parent.removeChild(this._div),this._nameDiv&&this._parent.removeChild(this._nameDiv)}}class Z{constructor(r,e,i){if(Object.defineProperty(this,"_unobserveFns",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"_cursors",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"_areaID",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"_textField",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._areaID=e.id,this._textField=e,e.id==="")throw new Error("ID attribute is required on textarea/field if using cursors");if(e.selectionStart===null||e.selectionEnd===null)throw new Error("unSupported Input type");const s=r.doc;if(s===null)throw new Error("Missing doc on yText");const n=h=>{if(h.removed.length!=0){for(const v of h.removed)if(this._cursors.has(v)){const b=this._cursors.get(v);b==null||b.destroy(),this._cursors.delete(v)}}const u=getComputedStyle(e).getPropertyValue("font-size"),c=i.awareness.getStates();for(const[v,b]of c.entries()){if(v===i.awareness.clientID)continue;const d=b[this._areaID];if(d===void 0)continue;const m=d.start,p=d.end,_=d.name,f=d.color,w=d.selection;if(!this._cursors.has(v)&&!w)continue;this._cursors.has(v)||this._cursors.set(v,new K(u,f,e,_));const g=this._cursors.get(v);if(!w){g==null||g.setPosition(-1,-1),g==null||g.hide();continue}if(g==null||g.updateCursor(_,f),m===void 0||p===void 0)continue;const y=R.createAbsolutePositionFromRelativePosition(JSON.parse(m),s),S=R.createAbsolutePositionFromRelativePosition(JSON.parse(p),s);if(y===null||S===null){g==null||g.hide();continue}g==null||g.setPosition(y.index,S.index),g==null||g.rePosition(e)}};i.awareness.on("update",n),this._unobserveFns.push(()=>i.awareness.off("update",n));const o=()=>{const h=e.selectionStart,u=e.selectionEnd,c=R.createRelativePositionFromTypeIndex(r,h),v=R.createRelativePositionFromTypeIndex(r,u);i.awareness.setLocalStateField(this._areaID,{user:i.awareness.clientID,selection:!0,start:JSON.stringify(c),end:JSON.stringify(v),name:i.clientName,color:i.color||{r:45,g:80,b:237}})};for(const h of G)e.addEventListener(h,o),this._unobserveFns.push(()=>{e.removeEventListener(h,o)});const a=()=>{i.awareness.setLocalStateField(this._areaID,{user:i.awareness.clientID,selection:!1})};e.addEventListener("focusout",a),this._unobserveFns.push(()=>{e.removeEventListener("focusout",a)});const l=()=>{this.rePositionCursors()};e.addEventListener("scroll",l),this._unobserveFns.push(()=>{e.removeEventListener("scroll",l)})}rePositionCursors(){if(this._textField)for(const[r,e]of this._cursors)e.rePosition(this._textField)}destroy(){for(const r of this._unobserveFns)r();this._unobserveFns=[];for(const[r,e]of this._cursors)e.destroy();this._cursors.clear()}}var E=-1,I=1,P=0;function A(t,r,e,i){if(t===r)return t?[[P,t]]:[];if(e!=null){var s=te(t,r,e);if(s)return s}var n=L(t,r),o=t.substring(0,n);t=t.substring(n),r=r.substring(n),n=z(t,r);var a=t.substring(t.length-n);t=t.substring(0,t.length-n),r=r.substring(0,r.length-n);var l=q(t,r);return o&&l.unshift([P,o]),a&&l.push([P,a]),N(l,i),l}function q(t,r){var e;if(!t)return[[I,r]];if(!r)return[[E,t]];var i=t.length>r.length?t:r,s=t.length>r.length?r:t,n=i.indexOf(s);if(n!==-1)return e=[[I,i.substring(0,n)],[P,s],[I,i.substring(n+s.length)]],t.length>r.length&&(e[0][0]=e[2][0]=E),e;if(s.length===1)return[[E,t],[I,r]];var o=x(t,r);if(o){var a=o[0],l=o[1],h=o[2],u=o[3],c=o[4],v=A(a,h),b=A(l,u);return v.concat([[P,c]],b)}return k(t,r)}function k(t,r){for(var e=t.length,i=r.length,s=Math.ceil((e+i)/2),n=s,o=2*s,a=new Array(o),l=new Array(o),h=0;h<o;h++)a[h]=-1,l[h]=-1;a[n+1]=0,l[n+1]=0;for(var u=e-i,c=u%2!==0,v=0,b=0,d=0,m=0,p=0;p<s;p++){for(var _=-p+v;_<=p-b;_+=2){var f=n+_,w;_===-p||_!==p&&a[f-1]<a[f+1]?w=a[f+1]:w=a[f-1]+1;for(var g=w-_;w<e&&g<i&&t.charAt(w)===r.charAt(g);)w++,g++;if(a[f]=w,w>e)b+=2;else if(g>i)v+=2;else if(c){var y=n+u-_;if(y>=0&&y<o&&l[y]!==-1){var S=e-l[y];if(w>=S)return F(t,r,w,g)}}}for(var D=-p+d;D<=p-m;D+=2){var y=n+D,S;D===-p||D!==p&&l[y-1]<l[y+1]?S=l[y+1]:S=l[y-1]+1;for(var O=S-D;S<e&&O<i&&t.charAt(e-S-1)===r.charAt(i-O-1);)S++,O++;if(l[y]=S,S>e)m+=2;else if(O>i)d+=2;else if(!c){var f=n+u-D;if(f>=0&&f<o&&a[f]!==-1){var w=a[f],g=n+w-f;if(S=e-S,w>=S)return F(t,r,w,g)}}}}return[[E,t],[I,r]]}function F(t,r,e,i){var s=t.substring(0,e),n=r.substring(0,i),o=t.substring(e),a=r.substring(i),l=A(s,n),h=A(o,a);return l.concat(h)}function L(t,r){if(!t||!r||t.charAt(0)!==r.charAt(0))return 0;for(var e=0,i=Math.min(t.length,r.length),s=i,n=0;e<s;)t.substring(n,s)==r.substring(n,s)?(e=s,n=e):i=s,s=Math.floor((i-e)/2+e);return H(t.charCodeAt(s-1))&&s--,s}function z(t,r){if(!t||!r||t.slice(-1)!==r.slice(-1))return 0;for(var e=0,i=Math.min(t.length,r.length),s=i,n=0;e<s;)t.substring(t.length-s,t.length-n)==r.substring(r.length-s,r.length-n)?(e=s,n=e):i=s,s=Math.floor((i-e)/2+e);return Y(t.charCodeAt(t.length-s))&&s--,s}function x(t,r){var e=t.length>r.length?t:r,i=t.length>r.length?r:t;if(e.length<4||i.length*2<e.length)return null;function s(b,d,m){for(var p=b.substring(m,m+Math.floor(b.length/4)),_=-1,f="",w,g,y,S;(_=d.indexOf(p,_+1))!==-1;){var D=L(b.substring(m),d.substring(_)),O=z(b.substring(0,m),d.substring(0,_));f.length<O+D&&(f=d.substring(_-O,_)+d.substring(_,_+D),w=b.substring(0,m-O),g=b.substring(m+D),y=d.substring(0,_-O),S=d.substring(_+D))}return f.length*2>=b.length?[w,g,y,S,f]:null}var n=s(e,i,Math.ceil(e.length/4)),o=s(e,i,Math.ceil(e.length/2)),a;if(!n&&!o)return null;o?n?a=n[4].length>o[4].length?n:o:a=o:a=n;var l,h,u,c;t.length>r.length?(l=a[0],h=a[1],u=a[2],c=a[3]):(u=a[0],c=a[1],l=a[2],h=a[3]);var v=a[4];return[l,h,u,c,v]}function N(t,r){t.push([P,""]);for(var e=0,i=0,s=0,n="",o="",a;e<t.length;){if(e<t.length-1&&!t[e][1]){t.splice(e,1);continue}switch(t[e][0]){case I:s++,o+=t[e][1],e++;break;case E:i++,n+=t[e][1],e++;break;case P:var l=e-s-i-1;if(r){if(l>=0&&J(t[l][1])){var h=t[l][1].slice(-1);if(t[l][1]=t[l][1].slice(0,-1),n=h+n,o=h+o,!t[l][1]){t.splice(l,1),e--;var u=l-1;t[u]&&t[u][0]===I&&(s++,o=t[u][1]+o,u--),t[u]&&t[u][0]===E&&(i++,n=t[u][1]+n,u--),l=u}}if(B(t[e][1])){var h=t[e][1].charAt(0);t[e][1]=t[e][1].slice(1),n+=h,o+=h}}if(e<t.length-1&&!t[e][1]){t.splice(e,1);break}if(n.length>0||o.length>0){n.length>0&&o.length>0&&(a=L(o,n),a!==0&&(l>=0?t[l][1]+=o.substring(0,a):(t.splice(0,0,[P,o.substring(0,a)]),e++),o=o.substring(a),n=n.substring(a)),a=z(o,n),a!==0&&(t[e][1]=o.substring(o.length-a)+t[e][1],o=o.substring(0,o.length-a),n=n.substring(0,n.length-a)));var c=s+i;n.length===0&&o.length===0?(t.splice(e-c,c),e=e-c):n.length===0?(t.splice(e-c,c,[I,o]),e=e-c+1):o.length===0?(t.splice(e-c,c,[E,n]),e=e-c+1):(t.splice(e-c,c,[E,n],[I,o]),e=e-c+2)}e!==0&&t[e-1][0]===P?(t[e-1][1]+=t[e][1],t.splice(e,1)):e++,s=0,i=0,n="",o="";break}}t[t.length-1][1]===""&&t.pop();var v=!1;for(e=1;e<t.length-1;)t[e-1][0]===P&&t[e+1][0]===P&&(t[e][1].substring(t[e][1].length-t[e-1][1].length)===t[e-1][1]?(t[e][1]=t[e-1][1]+t[e][1].substring(0,t[e][1].length-t[e-1][1].length),t[e+1][1]=t[e-1][1]+t[e+1][1],t.splice(e-1,1),v=!0):t[e][1].substring(0,t[e+1][1].length)==t[e+1][1]&&(t[e-1][1]+=t[e+1][1],t[e][1]=t[e][1].substring(t[e+1][1].length)+t[e+1][1],t.splice(e+1,1),v=!0)),e++;v&&N(t,r)}function H(t){return t>=55296&&t<=56319}function Y(t){return t>=56320&&t<=57343}function B(t){return Y(t.charCodeAt(0))}function J(t){return H(t.charCodeAt(t.length-1))}function ee(t){for(var r=[],e=0;e<t.length;e++)t[e][1].length>0&&r.push(t[e]);return r}function T(t,r,e,i){return J(t)||B(i)?null:ee([[P,t],[E,r],[I,e],[P,i]])}function te(t,r,e){var i=typeof e=="number"?{index:e,length:0}:e.oldRange,s=typeof e=="number"?null:e.newRange,n=t.length,o=r.length;if(i.length===0&&(s===null||s.length===0)){var a=i.index,l=t.slice(0,a),h=t.slice(a),u=s?s.index:null;e:{var c=a+o-n;if(u!==null&&u!==c||c<0||c>o)break e;var v=r.slice(0,c),b=r.slice(c);if(b!==h)break e;var d=Math.min(a,c),m=l.slice(0,d),p=v.slice(0,d);if(m!==p)break e;var _=l.slice(d),f=v.slice(d);return T(m,_,f,h)}e:{if(u!==null&&u!==a)break e;var w=a,v=r.slice(0,w),b=r.slice(w);if(v!==l)break e;var g=Math.min(n-w,o-w),y=h.slice(h.length-g),S=b.slice(b.length-g);if(y!==S)break e;var _=h.slice(0,h.length-g),f=b.slice(0,b.length-g);return T(l,_,f,y)}}if(i.length>0&&s&&s.length===0){e:{var m=t.slice(0,i.index),y=t.slice(i.index+i.length),d=m.length,g=y.length;if(o<d+g)break e;var p=r.slice(0,d),S=r.slice(o-g);if(m!==p||y!==S)break e;var _=t.slice(d,n-g),f=r.slice(d,o-g);return T(m,_,f,y)}}return null}function M(t,r,e){return A(t,r,e,!0)}M.INSERT=I,M.DELETE=E,M.EQUAL=P;var re=M;class ne{constructor(r,e,i){Object.defineProperty(this,"_cursors",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_unobserveFns",{enumerable:!0,configurable:!0,writable:!0,value:[]});let s=r.doc;if(s===null)throw new Error("Missing doc on yText");if(e.selectionStart===void 0||e.selectionEnd===void 0)throw new Error("textField argument doesn't look like a text field");i&&(this._cursors=new Z(r,e,i)),e.value=r.toString();let n,o,a;const l=()=>{a=e.selectionDirection;const v=this.createRange(e);n=R.createRelativePositionFromTypeIndex(r,v.left),o=R.createRelativePositionFromTypeIndex(r,v.right)};s.on("beforeTransaction",l),this._unobserveFns.push(()=>s.off("beforeTransaction",l));let h=!1;const u=(v,b)=>{if(b.local&&h){h=!1;return}if(e.value=r.toString(),e.getRootNode().activeElement===e){const d=R.createAbsolutePositionFromRelativePosition(n,s),m=R.createAbsolutePositionFromRelativePosition(o,s);d!==null&&m!==null&&(a===null&&(a="forward"),e.setSelectionRange(d.index,m.index,a))}};r.observe(u),this._unobserveFns.push(()=>r.unobserve(u));const c=()=>{h=!0;const v=this.createRange(e);let b=r.toString(),d=e.value,m=re(b,d,v.left),p=0;for(let _=0;_<m.length;_++){let f=m[_];f[0]===0?p+=f[1].length:f[0]===-1?r.delete(p,f[1].length):(r.insert(p,f[1]),p+=f[1].length)}};e.addEventListener("input",c),this._unobserveFns.push(()=>e.removeEventListener("input",c))}createRange(r){const e=r.selectionStart,i=r.selectionEnd;return{left:e,right:i}}rePositionCursors(){var r;(r=this._cursors)==null||r.rePositionCursors()}destroy(){for(const r of this._unobserveFns)r();this._unobserveFns=[],this._cursors&&this._cursors.destroy()}}C.TextAreaBinding=ne,Object.defineProperty(C,"__esModule",{value:!0}),C[Symbol.toStringTag]="Module"});
