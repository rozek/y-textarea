(function(A,R){typeof exports=="object"&&typeof module!="undefined"?R(exports,require("yjs")):typeof define=="function"&&define.amd?define(["exports","yjs"],R):(A=typeof globalThis!="undefined"?globalThis:A||self,R(A["y-textArea"]={},A.Y))})(this,function(A,R){"use strict";var ge=Object.defineProperty;var _e=(A,R,O)=>R in A?ge(A,R,{enumerable:!0,configurable:!0,writable:!0,value:O}):A[R]=O;var E=(A,R,O)=>(_e(A,typeof R!="symbol"?R+"":R,O),O);function O(e){if(e&&e.__esModule)return e;var r=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});return e&&Object.keys(e).forEach(function(n){if(n!=="default"){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(r,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}}),r.default=e,Object.freeze(r)}var L=O(R),H={exports:{}};(function(e){(function(){var r=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],n=typeof window!="undefined",i=n&&window.mozInnerScreenX!=null;function s(t,a,o){if(!n)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var l=o&&o.debug||!1;if(l){var h=document.querySelector("#input-textarea-caret-position-mirror-div");h&&h.parentNode.removeChild(h)}var c=document.createElement("div");c.id="input-textarea-caret-position-mirror-div",document.body.appendChild(c);var v=c.style,u=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,g=t.nodeName==="INPUT";v.whiteSpace="pre-wrap",g||(v.wordWrap="break-word"),v.position="absolute",l||(v.visibility="hidden"),r.forEach(function(m){g&&m==="lineHeight"?v.lineHeight=u.height:v[m]=u[m]}),i?t.scrollHeight>parseInt(u.height)&&(v.overflowY="scroll"):v.overflow="hidden",c.textContent=t.value.substring(0,a),g&&(c.textContent=c.textContent.replace(/\s/g,"\xA0"));var b=document.createElement("span");b.textContent=t.value.substring(a)||".",c.appendChild(b);var f={top:b.offsetTop+parseInt(u.borderTopWidth),left:b.offsetLeft+parseInt(u.borderLeftWidth),height:parseInt(u.lineHeight)};return l?b.style.backgroundColor="#aaa":document.body.removeChild(c),f}e.exports=s})()})(H);var Y=H.exports;function K(e,r){const n=Math.max(e.x,r.x),i=Math.min(e.x+e.width,r.x+r.width);if(i<n)return null;const s=Math.max(e.y,r.y),t=Math.min(e.y+e.height,r.y+r.height);return t<s?null:new k(n,s,i-n,t-s)}class k{constructor(r,n,i,s){this.x=r,this.y=n,this.width=i,this.height=s}get area(){return this.width*this.height}}var q=K;const x=["keyup","mouseup","touchstart","paste","cut","selectend"];class ee{constructor(r,n,i,s){E(this,"_div");E(this,"_nameDiv");E(this,"_color");E(this,"_fontSize");E(this,"_selectedIndex");E(this,"_name");E(this,"_parent");this._selectedIndex={start:-1,end:-1},this._fontSize=r,this._parent=i.offsetParent||document.body,this._div=document.createElement("div"),this._div.style.position="absolute",this._div.style.height=r,this._div.style.width="1px",this._div.style.display="none",this._div.classList.add("selectedText"),this._parent.appendChild(this._div),s!==void 0&&this.updateCursor(s,n)}show(){this._div.style.display="block",this._nameDiv&&(this._nameDiv.style.display="block")}hide(){this._div.style.display="none",this._nameDiv&&(this._nameDiv.style.display="none")}updateCursor(r,n){this._name===r&&this._color.r===n.r&&this._color.g===n.g&&this._color.b===n.b||(this._color=n,this._name=r,this._nameDiv||(this._nameDiv=document.createElement("div"),this._nameDiv.style.position="absolute",this._nameDiv.style.display="none",this._nameDiv.classList.add("nameTag"),this._parent.appendChild(this._nameDiv)),this._nameDiv.innerText=r,this._nameDiv.style.backgroundColor=`rgba(${this._color.r}, ${this._color.g}, ${this._color.b}, 1.0)`,this._div.style.backgroundColor=`rgba(${this._color.r}, ${this._color.g}, ${this._color.b}, 0.4)`)}setPosition(r,n){this._selectedIndex={start:r,end:n}}setWidth(r){this._div.style.width=r+"px",r===1?this._div.style.backgroundColor=`rgba(${this._color.r}, ${this._color.g}, ${this._color.b}, 1.0)`:this._div.style.backgroundColor=`rgba(${this._color.r}, ${this._color.g}, ${this._color.b}, 0.4)`}rePosition(r){if(this._selectedIndex.start===-1||this._selectedIndex.end===-1)return;const n=Y(r,this._selectedIndex.start),i=r.offsetTop-r.scrollTop+n.top,s=r.offsetLeft-r.scrollLeft+n.left;let t=1,a=0;if(this._selectedIndex.start!==this._selectedIndex.end){let c=Y(r,this._selectedIndex.end);t=c.left-n.left,a=c.top-n.top,a!==0&&(t=1)}const o={x:r.offsetLeft,y:r.offsetTop,width:r.clientWidth,height:r.clientHeight},l={x:s,y:i,width:t,height:parseInt(this._fontSize)},h=q(o,l);if(!h){this.hide();return}this._div.style.top=h.y+"px",this._div.style.left=h.x+"px",this.setWidth(h.width),this.show(),this._nameDiv&&(this._nameDiv.style.top=h.y+parseInt(this._fontSize)+"px",this._nameDiv.style.left=h.x+"px")}destroy(){this._parent.removeChild(this._div),this._nameDiv&&this._parent.removeChild(this._nameDiv)}}class ne{constructor(r,n,i){E(this,"_unobserveFns",[]);E(this,"_cursors",new Map);E(this,"_areaID","");E(this,"_textField");if(this._areaID=n.id,this._textField=n,n.id==="")throw new Error("ID attribute is required on textarea/field if using cursors");if(n.selectionStart===null||n.selectionEnd===null)throw new Error("unSupported Input type");const s=r.doc;if(s===null)throw new Error("Missing doc on yText");const t=h=>{if(h.removed.length!=0){for(const u of h.removed)if(this._cursors.has(u)){const g=this._cursors.get(u);g==null||g.destroy(),this._cursors.delete(u)}}const c=getComputedStyle(n).getPropertyValue("font-size"),v=i.awareness.getStates();for(const[u,g]of v.entries()){if(u===i.awareness.clientID)continue;const b=g[this._areaID];if(b===void 0)continue;const f=b.start,m=b.end,p=b.name,d=b.color,w=b.selection;if(!this._cursors.has(u)&&!w)continue;this._cursors.has(u)||this._cursors.set(u,new ee(c,d,n,p));const _=this._cursors.get(u);if(!w){_==null||_.setPosition(-1,-1),_==null||_.hide();continue}if(_==null||_.updateCursor(p,d),f===void 0||m===void 0)continue;const S=L.createAbsolutePositionFromRelativePosition(JSON.parse(f),s),I=L.createAbsolutePositionFromRelativePosition(JSON.parse(m),s);if(S===null||I===null){_==null||_.hide();continue}_==null||_.setPosition(S.index,I.index),_==null||_.rePosition(n)}};i.awareness.on("update",t),this._unobserveFns.push(()=>i.awareness.off("update",t));const a=()=>{const h=n.selectionStart,c=n.selectionEnd,v=L.createRelativePositionFromTypeIndex(r,h),u=L.createRelativePositionFromTypeIndex(r,c);i.awareness.setLocalStateField(this._areaID,{user:i.awareness.clientID,selection:!0,start:JSON.stringify(v),end:JSON.stringify(u),name:i.clientName,color:i.color||{r:45,g:80,b:237}})};for(const h of x)n.addEventListener(h,a),this._unobserveFns.push(()=>{n.removeEventListener(h,a)});const o=()=>{i.awareness.setLocalStateField(this._areaID,{user:i.awareness.clientID,selection:!1})};n.addEventListener("focusout",o),this._unobserveFns.push(()=>{n.removeEventListener("focusout",o)});const l=()=>{this.rePositionCursors()};n.addEventListener("scroll",l),this._unobserveFns.push(()=>{n.removeEventListener("scroll",l)})}rePositionCursors(){if(this._textField)for(const[r,n]of this._cursors)n.rePosition(this._textField)}destroy(){for(const r of this._unobserveFns)r();this._unobserveFns=[];for(const[r,n]of this._cursors)n.destroy();this._cursors.clear()}}var C=-1,P=1,D=0;function z(e,r,n,i,s){if(e===r)return e?[[D,e]]:[];if(n!=null){var t=ce(e,r,n);if(t)return t}var a=T(e,r),o=e.substring(0,a);e=e.substring(a),r=r.substring(a),a=$(e,r);var l=e.substring(e.length-a);e=e.substring(0,e.length-a),r=r.substring(0,r.length-a);var h=re(e,r);return o&&h.unshift([D,o]),l&&h.push([D,l]),j(h,s),i&&se(h),h}function re(e,r){var n;if(!e)return[[P,r]];if(!r)return[[C,e]];var i=e.length>r.length?e:r,s=e.length>r.length?r:e,t=i.indexOf(s);if(t!==-1)return n=[[P,i.substring(0,t)],[D,s],[P,i.substring(t+s.length)]],e.length>r.length&&(n[0][0]=n[2][0]=C),n;if(s.length===1)return[[C,e],[P,r]];var a=ie(e,r);if(a){var o=a[0],l=a[1],h=a[2],c=a[3],v=a[4],u=z(o,h),g=z(l,c);return u.concat([[D,v]],g)}return te(e,r)}function te(e,r){for(var n=e.length,i=r.length,s=Math.ceil((n+i)/2),t=s,a=2*s,o=new Array(a),l=new Array(a),h=0;h<a;h++)o[h]=-1,l[h]=-1;o[t+1]=0,l[t+1]=0;for(var c=n-i,v=c%2!==0,u=0,g=0,b=0,f=0,m=0;m<s;m++){for(var p=-m+u;p<=m-g;p+=2){var d=t+p,w;p===-m||p!==m&&o[d-1]<o[d+1]?w=o[d+1]:w=o[d-1]+1;for(var _=w-p;w<n&&_<i&&e.charAt(w)===r.charAt(_);)w++,_++;if(o[d]=w,w>n)g+=2;else if(_>i)u+=2;else if(v){var S=t+c-p;if(S>=0&&S<a&&l[S]!==-1){var I=n-l[S];if(w>=I)return B(e,r,w,_)}}}for(var y=-m+b;y<=m-f;y+=2){var S=t+y,I;y===-m||y!==m&&l[S-1]<l[S+1]?I=l[S+1]:I=l[S-1]+1;for(var M=I-y;I<n&&M<i&&e.charAt(n-I-1)===r.charAt(i-M-1);)I++,M++;if(l[S]=I,I>n)f+=2;else if(M>i)b+=2;else if(!v){var d=t+c-y;if(d>=0&&d<a&&o[d]!==-1){var w=o[d],_=t+w-d;if(I=n-I,w>=I)return B(e,r,w,_)}}}}return[[C,e],[P,r]]}function B(e,r,n,i){var s=e.substring(0,n),t=r.substring(0,i),a=e.substring(n),o=r.substring(i),l=z(s,t),h=z(a,o);return l.concat(h)}function T(e,r){if(!e||!r||e.charAt(0)!==r.charAt(0))return 0;for(var n=0,i=Math.min(e.length,r.length),s=i,t=0;n<s;)e.substring(t,s)==r.substring(t,s)?(n=s,t=n):i=s,s=Math.floor((i-n)/2+n);return Q(e.charCodeAt(s-1))&&s--,s}function F(e,r){var n=e.length,i=r.length;if(n==0||i==0)return 0;n>i?e=e.substring(n-i):n<i&&(r=r.substring(0,n));var s=Math.min(n,i);if(e==r)return s;for(var t=0,a=1;;){var o=e.substring(s-a),l=r.indexOf(o);if(l==-1)return t;a+=l,(l==0||e.substring(s-a)==r.substring(0,a))&&(t=a,a++)}}function $(e,r){if(!e||!r||e.slice(-1)!==r.slice(-1))return 0;for(var n=0,i=Math.min(e.length,r.length),s=i,t=0;n<s;)e.substring(e.length-s,e.length-t)==r.substring(r.length-s,r.length-t)?(n=s,t=n):i=s,s=Math.floor((i-n)/2+n);return V(e.charCodeAt(e.length-s))&&s--,s}function ie(e,r){var n=e.length>r.length?e:r,i=e.length>r.length?r:e;if(n.length<4||i.length*2<n.length)return null;function s(g,b,f){for(var m=g.substring(f,f+Math.floor(g.length/4)),p=-1,d="",w,_,S,I;(p=b.indexOf(m,p+1))!==-1;){var y=T(g.substring(f),b.substring(p)),M=$(g.substring(0,f),b.substring(0,p));d.length<M+y&&(d=b.substring(p-M,p)+b.substring(p,p+y),w=g.substring(0,f-M),_=g.substring(f+y),S=b.substring(0,p-M),I=b.substring(p+y))}return d.length*2>=g.length?[w,_,S,I,d]:null}var t=s(n,i,Math.ceil(n.length/4)),a=s(n,i,Math.ceil(n.length/2)),o;if(!t&&!a)return null;a?t?o=t[4].length>a[4].length?t:a:o=a:o=t;var l,h,c,v;e.length>r.length?(l=o[0],h=o[1],c=o[2],v=o[3]):(c=o[0],v=o[1],l=o[2],h=o[3]);var u=o[4];return[l,h,c,v,u]}function se(e){for(var r=!1,n=[],i=0,s=null,t=0,a=0,o=0,l=0,h=0;t<e.length;)e[t][0]==D?(n[i++]=t,a=l,o=h,l=0,h=0,s=e[t][1]):(e[t][0]==P?l+=e[t][1].length:h+=e[t][1].length,s&&s.length<=Math.max(a,o)&&s.length<=Math.max(l,h)&&(e.splice(n[i-1],0,[C,s]),e[n[i-1]+1][0]=P,i--,i--,t=i>0?n[i-1]:-1,a=0,o=0,l=0,h=0,s=null,r=!0)),t++;for(r&&j(e),le(e),t=1;t<e.length;){if(e[t-1][0]==C&&e[t][0]==P){var c=e[t-1][1],v=e[t][1],u=F(c,v),g=F(v,c);u>=g?(u>=c.length/2||u>=v.length/2)&&(e.splice(t,0,[D,v.substring(0,u)]),e[t-1][1]=c.substring(0,c.length-u),e[t+1][1]=v.substring(u),t++):(g>=c.length/2||g>=v.length/2)&&(e.splice(t,0,[D,c.substring(0,g)]),e[t-1][0]=P,e[t-1][1]=v.substring(0,v.length-g),e[t+1][0]=C,e[t+1][1]=c.substring(g),t++),t++}t++}}var J=/[^a-zA-Z0-9]/,U=/\s/,X=/[\r\n]/,ae=/\n\r?\n$/,oe=/^\r?\n\r?\n/;function le(e){function r(g,b){if(!g||!b)return 6;var f=g.charAt(g.length-1),m=b.charAt(0),p=f.match(J),d=m.match(J),w=p&&f.match(U),_=d&&m.match(U),S=w&&f.match(X),I=_&&m.match(X),y=S&&g.match(ae),M=I&&b.match(oe);return y||M?5:S||I?4:p&&!w&&_?3:w||_?2:p||d?1:0}for(var n=1;n<e.length-1;){if(e[n-1][0]==D&&e[n+1][0]==D){var i=e[n-1][1],s=e[n][1],t=e[n+1][1],a=$(i,s);if(a){var o=s.substring(s.length-a);i=i.substring(0,i.length-a),s=o+s.substring(0,s.length-a),t=o+t}for(var l=i,h=s,c=t,v=r(i,s)+r(s,t);s.charAt(0)===t.charAt(0);){i+=s.charAt(0),s=s.substring(1)+t.charAt(0),t=t.substring(1);var u=r(i,s)+r(s,t);u>=v&&(v=u,l=i,h=s,c=t)}e[n-1][1]!=l&&(l?e[n-1][1]=l:(e.splice(n-1,1),n--),e[n][1]=h,c?e[n+1][1]=c:(e.splice(n+1,1),n--))}n++}}function j(e,r){e.push([D,""]);for(var n=0,i=0,s=0,t="",a="",o;n<e.length;){if(n<e.length-1&&!e[n][1]){e.splice(n,1);continue}switch(e[n][0]){case P:s++,a+=e[n][1],n++;break;case C:i++,t+=e[n][1],n++;break;case D:var l=n-s-i-1;if(r){if(l>=0&&G(e[l][1])){var h=e[l][1].slice(-1);if(e[l][1]=e[l][1].slice(0,-1),t=h+t,a=h+a,!e[l][1]){e.splice(l,1),n--;var c=l-1;e[c]&&e[c][0]===P&&(s++,a=e[c][1]+a,c--),e[c]&&e[c][0]===C&&(i++,t=e[c][1]+t,c--),l=c}}if(Z(e[n][1])){var h=e[n][1].charAt(0);e[n][1]=e[n][1].slice(1),t+=h,a+=h}}if(n<e.length-1&&!e[n][1]){e.splice(n,1);break}if(t.length>0||a.length>0){t.length>0&&a.length>0&&(o=T(a,t),o!==0&&(l>=0?e[l][1]+=a.substring(0,o):(e.splice(0,0,[D,a.substring(0,o)]),n++),a=a.substring(o),t=t.substring(o)),o=$(a,t),o!==0&&(e[n][1]=a.substring(a.length-o)+e[n][1],a=a.substring(0,a.length-o),t=t.substring(0,t.length-o)));var v=s+i;t.length===0&&a.length===0?(e.splice(n-v,v),n=n-v):t.length===0?(e.splice(n-v,v,[P,a]),n=n-v+1):a.length===0?(e.splice(n-v,v,[C,t]),n=n-v+1):(e.splice(n-v,v,[C,t],[P,a]),n=n-v+2)}n!==0&&e[n-1][0]===D?(e[n-1][1]+=e[n][1],e.splice(n,1)):n++,s=0,i=0,t="",a="";break}}e[e.length-1][1]===""&&e.pop();var u=!1;for(n=1;n<e.length-1;)e[n-1][0]===D&&e[n+1][0]===D&&(e[n][1].substring(e[n][1].length-e[n-1][1].length)===e[n-1][1]?(e[n][1]=e[n-1][1]+e[n][1].substring(0,e[n][1].length-e[n-1][1].length),e[n+1][1]=e[n-1][1]+e[n+1][1],e.splice(n-1,1),u=!0):e[n][1].substring(0,e[n+1][1].length)==e[n+1][1]&&(e[n-1][1]+=e[n+1][1],e[n][1]=e[n][1].substring(e[n+1][1].length)+e[n+1][1],e.splice(n+1,1),u=!0)),n++;u&&j(e,r)}function Q(e){return e>=55296&&e<=56319}function V(e){return e>=56320&&e<=57343}function Z(e){return V(e.charCodeAt(0))}function G(e){return Q(e.charCodeAt(e.length-1))}function he(e){for(var r=[],n=0;n<e.length;n++)e[n][1].length>0&&r.push(e[n]);return r}function W(e,r,n,i){return G(e)||Z(i)?null:he([[D,e],[C,r],[P,n],[D,i]])}function ce(e,r,n){var i=typeof n=="number"?{index:n,length:0}:n.oldRange,s=typeof n=="number"?null:n.newRange,t=e.length,a=r.length;if(i.length===0&&(s===null||s.length===0)){var o=i.index,l=e.slice(0,o),h=e.slice(o),c=s?s.index:null;e:{var v=o+a-t;if(c!==null&&c!==v||v<0||v>a)break e;var u=r.slice(0,v),g=r.slice(v);if(g!==h)break e;var b=Math.min(o,v),f=l.slice(0,b),m=u.slice(0,b);if(f!==m)break e;var p=l.slice(b),d=u.slice(b);return W(f,p,d,h)}e:{if(c!==null&&c!==o)break e;var w=o,u=r.slice(0,w),g=r.slice(w);if(u!==l)break e;var _=Math.min(t-w,a-w),S=h.slice(h.length-_),I=g.slice(g.length-_);if(S!==I)break e;var p=h.slice(0,h.length-_),d=g.slice(0,g.length-_);return W(l,p,d,S)}}if(i.length>0&&s&&s.length===0){e:{var f=e.slice(0,i.index),S=e.slice(i.index+i.length),b=f.length,_=S.length;if(a<b+_)break e;var m=r.slice(0,b),I=r.slice(a-_);if(f!==m||S!==I)break e;var p=e.slice(b,t-_),d=r.slice(b,a-_);return W(f,p,d,S)}}return null}function N(e,r,n,i){return z(e,r,n,i,!0)}N.INSERT=P,N.DELETE=C,N.EQUAL=D;var ve=N;class ue{constructor(r,n,i){E(this,"_cursors");E(this,"_unobserveFns",[]);let s=r.doc;if(s===null)throw new Error("Missing doc on yText");if(n.selectionStart===void 0||n.selectionEnd===void 0)throw new Error("textField argument doesn't look like a text field");i&&(this._cursors=new ne(r,n,i)),n.value=r.toString();let t,a,o;const l=()=>{o=n.selectionDirection;const u=this.createRange(n);t=L.createRelativePositionFromTypeIndex(r,u.left),a=L.createRelativePositionFromTypeIndex(r,u.right)};s.on("beforeTransaction",l),this._unobserveFns.push(()=>s.off("beforeTransaction",l));let h=!1;const c=(u,g)=>{if(g.local&&h){h=!1;return}if(n.value=r.toString(),n.getRootNode().activeElement===n){const b=L.createAbsolutePositionFromRelativePosition(t,s),f=L.createAbsolutePositionFromRelativePosition(a,s);b!==null&&f!==null&&(o===null&&(o="forward"),n.setSelectionRange(b.index,f.index,o))}};r.observe(c),this._unobserveFns.push(()=>r.unobserve(c));const v=()=>{h=!0;const u=this.createRange(n);let g=r.toString(),b=n.value,f=ve(g,b,u.left),m=0;for(let p=0;p<f.length;p++){let d=f[p];d[0]===0?m+=d[1].length:d[0]===-1?r.delete(m,d[1].length):(r.insert(m,d[1]),m+=d[1].length)}};n.addEventListener("input",v),this._unobserveFns.push(()=>n.removeEventListener("input",v))}createRange(r){const n=r.selectionStart,i=r.selectionEnd;return{left:n,right:i}}rePositionCursors(){var r;(r=this._cursors)==null||r.rePositionCursors()}destroy(){for(const r of this._unobserveFns)r();this._unobserveFns=[],this._cursors&&this._cursors.destroy()}}A.TextAreaBinding=ue,Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
